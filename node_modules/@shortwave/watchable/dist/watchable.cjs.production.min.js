"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react");function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}function n(t){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(t)}function r(t,e){return r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function o(t,e,n){return o=u()?Reflect.construct:function(t,e,n){var u=[null];u.push.apply(u,e);var o=new(Function.bind.apply(t,u));return n&&r(o,n.prototype),o},o.apply(null,arguments)}function a(t){var e="function"==typeof Map?new Map:void 0;return a=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,u)}function u(){return o(t,arguments,n(this).constructor)}return u.prototype=Object.create(t.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),r(u,t)},a(t)}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f=function(){function t(){this.callbacks=new Set}var e=t.prototype;return e.add=function(t){var e=this;if(this.callbacks.has(t))throw new Error("Can't add subscription twice!");return this.callbacks.add(t),function(){if(!e.callbacks.delete(t))throw new Error("Did not find callback function for unsubscribe")}},e.isEmpty=function(){return 0===this.callbacks.size},e.forEach=function(t){return Array.from(this.callbacks).forEach(t)},t}(),l=function(){function t(){}var e=t.prototype;return e.getOrDefault=function(t){return this.hasValue()?this.getValue():t},e.map=function(t){var e,n,r=this,u=(e=t,n=null,function(t){return n?n.input!==t&&(n.input=t,n.output=e(t)):n={input:t,output:e(t)},n.output});return new s({hasValue:function(){return r.hasValue()},getValue:function(){return u(r.getValue())},watch:function(t){return r.watch((function(e){return t(u(e))}))}})},e.withHooks=function(t){var e=this,n=t.setup,r=t.tearDown,u=0;return new s({hasValue:function(){return e.hasValue()},getValue:function(){return e.getValue()},watch:function(t){var o=0===u;u++;var a=e.watch(t);return o&&n(),function(){a(),0==--u&&r()}}})},e.toPromise=function(){var t=this;return new Promise((function(e){var n=!1,r=null;r=t.watch((function(t){e(t),r?r():n=!0})),n&&r()}))},e.snapshot=function(){if(this.hasValue())return p.of(this.getValue());var t=p.empty();return this.toPromise().then((function(e){return t.update(e)})),t},t}(),s=function(t){function n(e){var n;return(n=t.call(this)||this).source=void 0,n.source=e,n}e(n,t);var r=n.prototype;return r.hasValue=function(){return this.source.hasValue()},r.getValue=function(){return this.source.getValue()},r.watch=function(t){return this.source.watch(t)},n}(l),h=function(t){function n(){return t.call(this,"You must check hasValue() before accessing a watchable value.")||this}return e(n,t),n}(a(Error)),p=function(t){function n(e){var n;return(n=t.call(this)||this).subscriptions=new f,n.currentValue=null,n.currentValue=e,n}e(n,t);var r=n.prototype;return r.hasValue=function(){return null!==this.currentValue},r.getValue=function(){if(!this.currentValue)throw new h;return this.currentValue.current},n.empty=function(){return new n(null)},n.of=function(t){return new n({current:t})},r.update=function(t){this.currentValue&&this.currentValue.current===t||(this.currentValue={current:t},this.subscriptions.forEach((function(e){return e(t)})))},r.watch=function(t){var e=this.subscriptions.add(t);return this.hasValue()&&t(this.getValue()),e},n}(l);function v(t){return b(null,t)}function b(e,n){var r=t.useState(n.hasValue()?n.getValue():e),u=r[0],o=r[1];return t.useEffect((function(){return n.watch(o)}),[n]),u}exports.Watchable=l,exports.WatchableSubject=p,exports.partialCombineWatchable=function(t){if(0===t.size)return p.of(new Map);var e=p.empty(),n=new Map(t),r=function(){for(var t,r=function(){var t=new Map;return n.forEach((function(e,n){e.hasValue()&&t.set(n,e.getValue())})),t}(),u=e.getOrDefault(new Map),o=i(r.entries());!(t=o()).done;){var a=t.value,c=a[1];if(u.get(a[0])!==c)return void e.update(r)}};return r(),new s({hasValue:function(){return e.hasValue()},getValue:function(){return e.getValue()},watch:function(t){return function(t){var u=[],o=!1;n.forEach((function(t){u.push(t.watch((function(){o&&r()})))})),o=!0;var a=e.watch(t);return function(){a();for(var t,e=i(u);!(t=e()).done;)(0,t.value)()}}(t)}})},exports.useExplicitWatchable=b,exports.useMemoizedWatchable=function(e,n){return v(t.useMemo(e,n))},exports.useWatchable=v;
//# sourceMappingURL=watchable.cjs.production.min.js.map
